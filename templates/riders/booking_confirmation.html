{% extends 'core/base.html' %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
<style>
    :root {
        --primary: #00b894;
        --primary-light: #55efc4;
        --secondary: #0984e3;
        --success: #00b894;
        --warning: #fdcb6e;
        --danger: #ff7675;
        --dark: #2d3436;
        --light: #f8f9fa;
    }
    
    body {
        background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
        min-height: 100vh;
        font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    }
    
    .confirmation-container {
        max-width: 800px;
        margin: 2rem auto;
        padding: 0 1rem;
    }
    
    .confirmation-card {
        border: none;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        background: #fff;
        position: relative;
        z-index: 1;
        transform: translateY(0);
        opacity: 1;
        transition: all 0.4s ease;
    }
    
    .confirmation-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
    }
    
    .confirmation-header {
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        color: white;
        padding: 2.5rem 2rem;
        text-align: center;
        position: relative;
        overflow: hidden;
    }
    
    .confetti {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        pointer-events: none;
        z-index: -1;
    }
    
    .checkmark {
        width: 80px;
        height: 80px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1.5rem;
        animation: pulse 2s infinite;
    }
    
    .checkmark i {
        font-size: 3.5rem;
        color: white;
    }
    
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }
    
    .confirmation-title {
        font-size: 2.2rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .confirmation-subtitle {
        font-size: 1.1rem;
        opacity: 0.9;
        margin-bottom: 1.5rem;
    }
    
    .status-badge {
        display: inline-block;
        padding: 0.5rem 1.2rem;
        border-radius: 50px;
        font-weight: 600;
        font-size: 0.9rem;
        letter-spacing: 0.5px;
        text-transform: uppercase;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .status-pending {
        background: var(--warning);
        color: #000;
    }
    
    .status-approved {
        background: var(--success);
        color: white;
    }
    
    .confirmation-body {
        padding: 2.5rem;
    }
    
    .info-card {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        border-left: 4px solid var(--primary);
        transition: all 0.3s ease;
    }
    
    .info-card:hover {
        transform: translateX(5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }
    
    .info-card h5 {
        color: var(--dark);
        font-weight: 700;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .info-card h5 i {
        color: var(--primary);
    }
    
    .info-item {
        display: flex;
        margin-bottom: 0.5rem;
        font-size: 0.95rem;
    }
    
    .info-label {
        color: #6c757d;
        min-width: 100px;
        font-weight: 500;
    }
    
    .info-value {
        color: #343a40;
        font-weight: 500;
    }
    
    .btn-download {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
        border: none;
        color: white;
        font-weight: 600;
        padding: 0.75rem 1.5rem;
        border-radius: 50px;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 184, 148, 0.3);
    }
    
    .btn-download:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 184, 148, 0.4);
        color: white;
    }
    
    .btn-dashboard {
        background: white;
        border: 2px solid var(--primary);
        color: var(--primary);
        font-weight: 600;
        padding: 0.75rem 1.5rem;
        border-radius: 50px;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
    }
    
    .btn-dashboard:hover {
        background: var(--primary);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    .action-buttons {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 2.5rem;
    }
    
    @media (max-width: 768px) {
        .confirmation-container {
            padding: 1rem;
        }
        
        .confirmation-body {
            padding: 1.5rem;
        }
        
        .action-buttons {
            flex-direction: column;
            gap: 1rem;
        }
        
        .action-buttons .btn {
            width: 100%;
            text-align: center;
        }
    }
    
    /* Animation for the success checkmark */
    @keyframes checkmark {
        0% { transform: scale(0); opacity: 0; }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); opacity: 1; }
    }
    
    .animate-checkmark {
        animation: checkmark 0.6s cubic-bezier(0.42, 0, 0.27, 1.55) forwards;
    }
    
    /* Floating animation for the bike icon */
    .bike-icon {
        animation: float 6s ease-in-out infinite;
    }
    
    @keyframes float {
        0% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
        100% { transform: translateY(0px); }
    }
</style>

<div class="confirmation-container">
    <div class="confirmation-card">
        <div class="confirmation-header">
            <div class="confetti" id="confetti"></div>
            <div class="checkmark animate-checkmark">
                <i class="bi {% if booking.status == 'approved' %}bi-check-circle-fill{% else %}bi-hourglass-split{% endif %}"></i>
            </div>
            <h1 class="confirmation-title">
                {% if booking.status == 'approved' %}
                    Booking Confirmed!
                {% else %}
                    Payment Received!
                {% endif %}
            </h1>
            <p class="confirmation-subtitle">
                {% if booking.status == 'approved' %}
                    Your booking has been approved and is now active.
                {% else %}
                    Your payment was successful. Your booking is pending admin approval.
                {% endif %}
            </p>
            
            <div class="status-badge {% if booking.status == 'approved' %}status-approved{% else %}status-pending{% endif %}">
                {{ booking.get_status_display }}
            </div>
        </div>
        
        <div class="confirmation-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="info-card">
                        <h5><i class="bi bi-bicycle bike-icon"></i> E-Bike Details</h5>
                        <div class="info-item">
                            <span class="info-label">Model:</span>
                            <span class="info-value">{{ booking.ebike.name }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Booking ID:</span>
                            <span class="info-value">#{{ booking.id|stringformat:"06d" }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Duration:</span>
                            <span class="info-value">{{ booking.start_date|date:"M d, Y" }} - {{ booking.end_date|date:"M d, Y" }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Pickup Location:</span>
                            <span class="info-value">AIS E-Bike Rental Center</span>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="info-card">
                        <h5><i class="bi bi-credit-card"></i> Payment Summary</h5>
                        <div class="info-item">
                            <span class="info-label">Subtotal:</span>
                            <span class="info-value">â‚¹{{ booking.total_price|floatformat:2 }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Taxes & Fees:</span>
                            <span class="info-value">Included</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Payment Status:</span>
                            <span class="info-value">
                                {% if booking.is_paid %}
                                    <span class="badge bg-success"><i class="bi bi-check-circle me-1"></i>Paid</span>
                                {% else %}
                                    <span class="badge bg-warning text-dark"><i class="bi bi-hourglass-split me-1"></i>Pending</span>
                                {% endif %}
                            </span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Total Amount:</span>
                            <span class="info-value fw-bold text-success">â‚¹{{ booking.total_price|floatformat:2 }}</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="info-card">
                <h5><i class="bi bi-info-circle"></i> Next Steps</h5>
                <div class="d-flex align-items-start mb-3">
                    <div class="me-3 text-primary">
                        <i class="bi bi-1-circle-fill"></i>
                    </div>
                    <div>
                        <h6 class="mb-1">Pickup Confirmation</h6>
                        <p class="small text-muted mb-0">You'll receive a confirmation email with pickup details once your booking is approved.</p>
                    </div>
                </div>
                <div class="d-flex align-items-start mb-3">
                    <div class="me-3 text-primary">
                        <i class="bi bi-2-circle-fill"></i>
                    </div>
                    <div>
                        <h6 class="mb-1">Required Documents</h6>
                        <p class="small text-muted mb-0">Please bring your original ID proof and driving license when picking up the e-bike.</p>
                    </div>
                </div>
                <div class="d-flex align-items-start">
                    <div class="me-3 text-primary">
                        <i class="bi bi-3-circle-fill"></i>
                    </div>
                    <div>
                        <h6 class="mb-1">Need Help?</h6>
                        <p class="small text-muted mb-0">Contact our support team at <a href="mailto:support@aisebike.com" class="text-decoration-none">support@aisebike.com</a> or call +91 XXXXXXXXXX</p>
                    </div>
                </div>
            </div>
            
            <div class="text-center mt-4">
                <div class="action-buttons">
                    <a href="{% url 'rider_dashboard' %}" class="btn btn-dashboard">
                        <i class="bi bi-speedometer2 me-1"></i> Go to Dashboard
                    </a>
                    {% if booking.status == 'approved' %}
                        <a href="{% url 'view_receipt' booking.id %}" class="btn btn-download">
                            <i class="bi bi-eye me-1"></i> View Modern Receipt
                        </a>
                        <a href="{% url 'download_receipt' booking.id %}" class="btn btn-download">
                            <i class="bi bi-download me-1"></i> Download PDF Receipt
                        </a>
                    {% else %}
                        <button class="btn btn-secondary" disabled>
                            <i class="bi bi-hourglass me-1"></i> Receipt Available After Approval
                        </button>
                    {% endif %}
                </div>
                
                {% if booking.status != 'approved' %}
                <div class="alert alert-info mt-3" role="alert">
                    <i class="bi bi-info-circle me-2"></i>
                    Your booking is under review. You'll receive an email once it's approved.
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Confetti Effect -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Trigger confetti effect
    function triggerConfetti() {
        const duration = 3 * 1000;
        const animationEnd = Date.now() + duration;
        const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
        
        function randomInRange(min, max) {
            return Math.random() * (max - min) + min;
        }
        
        const interval = setInterval(function() {
            const timeLeft = animationEnd - Date.now();
            
            if (timeLeft <= 0) {
                return clearInterval(interval);
            }
            
            const particleCount = 50 * (timeLeft / duration);
            
            // Random confetti from the left
            confetti({
                ...defaults,
                particleCount,
                origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 }
            });
            
            // Random confetti from the right
            confetti({
                ...defaults,
                particleCount,
                origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 }
            });
        }, 250);
    }
    
    // Trigger confetti with a small delay for better UX
    setTimeout(triggerConfetti, 500);
    
    // Add animation to elements when they come into view
    const animateOnScroll = function() {
        const elements = document.querySelectorAll('.info-card');
        elements.forEach((element, index) => {
            const elementTop = element.getBoundingClientRect().top;
            const elementVisible = 150;
            
            if (elementTop < window.innerHeight - elementVisible) {
                element.style.opacity = '1';
                element.style.transform = 'translateX(0)';
            }
        });
    };
    
    // Set initial state for animation
    document.querySelectorAll('.info-card').forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateX(20px)';
        card.style.transition = `opacity 0.5s ease ${index * 0.1}s, transform 0.5s ease ${index * 0.1}s`;
    });
    
    // Run once on load
    animateOnScroll();
    
    // And on scroll
    window.addEventListener('scroll', animateOnScroll);
});
</script>
{% endblock %}
