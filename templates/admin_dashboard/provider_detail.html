{% extends 'core/base.html' %}
{% block title %}Provider Details - {{ provider.username }}{% endblock %}
{% block content %}
<div class="container-xxl py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0"><i class="fas fa-user-tie me-2"></i>Provider: {{ provider.username }}</h2>
    <a href="{% url 'admin_dashboard' %}#providers" class="btn btn-outline-secondary btn-sm"><i class="fas fa-arrow-left me-1"></i>Back</a>
  </div>

  <!-- Statistics Row -->
  <div class="row g-3 mb-4">
    <div class="col-md-2">
      <div class="card text-center h-100 border-0 shadow-lg rounded-4 overflow-hidden">
        <div class="card-header bg-gradient-success text-white border-0 py-2">
          <div class="d-inline-flex align-items-center justify-content-center rounded-circle bg-white bg-opacity-25 me-2" style="width: 32px; height: 32px;">
            <i class="fas fa-coins text-white fa-sm"></i>
          </div>
          <span class="fw-bold fs-6 text-uppercase">Earnings</span>
        </div>
        <div class="card-body bg-light py-3 d-flex align-items-center justify-content-center" style="min-height: 80px;">
          <div>
            <div class="fs-3 fw-bold text-success">₹{{ total_earnings|floatformat:0 }}</div>
            <div class="small text-muted fw-medium">Total Revenue</div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-2">
      <div class="card text-center h-100 border-0 shadow-lg rounded-4 overflow-hidden">
        <div class="card-header bg-gradient-primary text-white border-0 py-2">
          <div class="d-inline-flex align-items-center justify-content-center rounded-circle bg-white bg-opacity-25 me-2" style="width: 32px; height: 32px;">
            <i class="fas fa-bicycle text-white fa-sm"></i>
          </div>
          <span class="fw-bold fs-6 text-uppercase">Fleet</span>
        </div>
        <div class="card-body bg-light py-2 d-flex align-items-center justify-content-center" style="min-height: 80px;">
          <div class="d-flex flex-wrap gap-1 justify-content-center">
            {% for ebike in provider.ebikes.all|slice:":2" %}
              <div class="text-center" style="min-width: 50px;">
                {% if ebike.image %}
                  <img src="{{ ebike.image.url }}" alt="{{ ebike.name }}" class="rounded-3 mb-1 border" style="width: 38px; height: 26px; object-fit: cover;" />
                {% else %}
                  <img src="https://api.dicebear.com/7.x/icons/svg?seed={{ ebike.name }}" alt="{{ ebike.name }}" class="rounded-3 mb-1 border" style="width: 38px; height: 26px; object-fit: cover;" />
                {% endif %}
                <div class="small text-muted fw-medium" style="font-size: 0.65rem; line-height: 1;">{{ ebike.name }}</div>
              </div>
            {% endfor %}
            {% if total_bikes > 2 %}
              <div class="text-center align-self-center">
                <span class="badge bg-secondary rounded-pill fw-bold">+{{ total_bikes|add:"-2" }}</span>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-2">
      <div class="card text-center h-100 border-0 shadow-lg rounded-4 overflow-hidden">
        <div class="card-header bg-gradient-info text-white border-0 py-2">
          <div class="d-inline-flex align-items-center justify-content-center rounded-circle bg-white bg-opacity-25 me-2" style="width: 32px; height: 32px;">
            <i class="fas fa-hashtag text-white fa-sm"></i>
          </div>
          <span class="fw-bold fs-6 text-uppercase">Fleet Size</span>
        </div>
        <div class="card-body bg-light py-3 d-flex align-items-center justify-content-center" style="min-height: 80px;">
          <div>
            <div class="fs-3 fw-bold text-info">{{ total_bikes }}</div>
            <div class="small text-muted fw-medium">Total Bikes</div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-2">
      <div class="card text-center h-100 border-0 shadow-lg rounded-4 overflow-hidden">
        <div class="card-header bg-gradient-warning text-white border-0 py-2">
          <div class="d-inline-flex align-items-center justify-content-center rounded-circle bg-white bg-opacity-25 me-2" style="width: 32px; height: 32px;">
            <i class="fas fa-calendar-check text-white fa-sm"></i>
          </div>
          <span class="fw-bold fs-6 text-uppercase">Bookings</span>
        </div>
        <div class="card-body bg-light py-3 d-flex align-items-center justify-content-center" style="min-height: 80px;">
          <div>
            <div class="fs-3 fw-bold text-warning">{{ completed_bookings }}</div>
            <div class="small text-muted fw-medium">Completed Rents</div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-2">
      <div class="card text-center h-100 border-0 shadow-lg rounded-4 overflow-hidden">
        <div class="card-header bg-gradient-secondary text-white border-0 py-2">
          <div class="d-inline-flex align-items-center justify-content-center rounded-circle bg-white bg-opacity-25 me-2" style="width: 32px; height: 32px;">
            <i class="fas fa-star text-white fa-sm"></i>
          </div>
          <span class="fw-bold fs-6 text-uppercase">Rating</span>
        </div>
        <div class="card-body bg-light py-3 d-flex align-items-center justify-content-center" style="min-height: 80px;">
          <div>
            {% if average_rating %}
              <div class="fs-4 fw-bold text-warning">{{ average_rating|floatformat:1 }} <i class="fas fa-star"></i></div>
              <div class="small text-muted fw-medium">Average Score</div>
            {% else %}
              <div class="fs-4 fw-bold text-muted">—</div>
              <div class="small text-muted fw-medium">No Reviews Yet</div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-2">
      <div class="card text-center h-100 border-0 shadow-lg rounded-4 overflow-hidden">
        <div class="card-header bg-gradient-danger text-white border-0 py-2">
          <div class="d-inline-flex align-items-center justify-content-center rounded-circle bg-white bg-opacity-25 me-2" style="width: 32px; height: 32px;">
            <i class="fas fa-money-bill-wave text-white fa-sm"></i>
          </div>
          <span class="fw-bold fs-6 text-uppercase">Withdrawals</span>
        </div>
        <div class="card-body bg-light py-3 d-flex align-items-center justify-content-center" style="min-height: 80px;">
          <div>
            <div class="fs-3 fw-bold text-danger">{{ pending_withdrawals }}</div>
            <div class="small text-muted fw-medium">Pending Requests</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Additional Info Card -->
  <div class="row g-3 mb-4">
    <div class="col-12">
      <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
        <div class="card-header bg-gradient-dark text-white border-0 py-3">
          <div class="d-inline-flex align-items-center justify-content-center rounded-circle bg-white bg-opacity-25 me-2" style="width: 32px; height: 32px;">
            <i class="fas fa-id-card text-white fa-sm"></i>
          </div>
          <span class="fw-bold fs-5">Contact & Profile Information</span>
          {% if provider.is_verified_provider %}
            <span class="badge bg-success ms-auto rounded-pill"><i class="fas fa-check-circle me-1"></i>VERIFIED PROVIDER</span>
          {% else %}
            <span class="badge bg-warning text-dark ms-auto rounded-pill"><i class="fas fa-clock me-1"></i>PENDING VERIFICATION</span>
          {% endif %}
        </div>
        <div class="card-body bg-light p-4">
          <div class="row align-items-center">
            <div class="col-md-8">
              <div class="d-flex align-items-center">
                <img src="{% if provider.profile_image %}{{ provider.profile_image.url }}{% else %}https://api.dicebear.com/7.x/avataaars/svg?seed={{ provider.username }}{% endif %}"
                     alt="{{ provider.username }}" class="rounded-circle me-3 border" style="width: 80px; height: 80px; object-fit: cover;" />
                <div>
                  <h5 class="fw-bold mb-1 text-dark">{{ provider.username }}</h5>
                  <p class="mb-1 text-muted"><i class="fas fa-envelope me-2"></i>{{ provider.email }}</p>
                  <p class="mb-0 text-muted"><i class="fas fa-phone me-2"></i>{{ provider.mobile_number|default:'Phone not provided' }}</p>
                </div>
              </div>
            </div>
            <div class="col-md-4 text-end">
              <div class="d-flex flex-column gap-2">
                {% if provider.is_verified_provider %}
                  <button class="btn btn-outline-danger btn-sm rounded-pill" disabled>
                    <i class="fas fa-user-slash me-1"></i>Provider is Verified
                  </button>
                {% else %}
                  <button class="btn btn-success btn-sm rounded-pill" disabled>
                    <i class="fas fa-user-check me-1"></i>Verification Pending
                  </button>
                {% endif %}
                <a href="{% url 'review_documents' %}?provider={{ provider.id }}" class="btn btn-primary btn-sm rounded-pill">
                  <i class="fas fa-file-alt me-1"></i>Review Documents ({{ total_docs }})
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


</div>
{% endblock %}
